<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteio Aleat√≥rio</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
            max-width: 800px;
            margin: 20px 0;
        }

        #winners-list-container {
            flex: 1;
            padding-right: 20px;
        }

        #winners-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 1rem;
            color: #444;
            text-align: left;
        }

        #winners-list li {
            margin: 5px 0;
        }

        #main-container {
            flex: 2;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        #winner {
            font-size: 2rem;
            color: #007BFF;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 1.2rem;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #218838;
        }

        .disabled {
            background-color: #6c757d !important;
            cursor: not-allowed;
        }

        /* Estilo do Modal */
        #modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            /* Fundo preto transl√∫cido */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            /* Esconde o modal inicialmente */
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #modal.active {
            visibility: visible;
            /* Torna o modal vis√≠vel */
            opacity: 1;
        }

        #modal-content {
            background-color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            animation: pop-up 0.3s ease;
        }

        #modal-content h2 {
            color: #333;
            font-size: 1.8rem;
        }

        #modal-content button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1rem;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #modal-content button:hover {
            background-color: #0056b3;
        }

        /* Anima√ß√£o de entrada do modal */
        @keyframes pop-up {
            from {
                transform: scale(0.9);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div id="container">
        <!-- Se√ß√£o da lista de ganhadores -->
        <div id="winners-list-container">
            <ul id="winners-list"></ul>
        </div>

        <!-- Se√ß√£o principal de sorteio -->
        <div id="main-container">
            <h1>Sorteio de Nomes</h1>
            <button id="sortearBtn" disabled>Carregando...</button>
            <p id="winner"></p>
        </div>
    </div>

    <!-- Modal para exibi√ß√£o do ganhador -->
    <div id="modal">
        <div id="modal-content">
            <h2 id="modal-winner">üéâ Nome do Ganhador üéâ</h2>
            <button id="closeModalBtn">OK</button>
        </div>
    </div>

    <script>
        // URL do arquivo JSON no GitHub (raw link do arquivo)
        const GITHUB_JSON_URL = "https://raw.githubusercontent.com/AlbertoJunior22/sorteio_lemon3D/refs/heads/main/data.json";

        let data = []; // Armazena os dados trazidos do arquivo JSON
        let remainingNames = []; // Lista com nomes √∫nicos
        const winnersList = document.getElementById('winners-list');
        const sortearBtn = document.getElementById('sortearBtn');
        const winnerDisplay = document.getElementById('winner');
        const modal = document.getElementById("modal"); // Modal
        const modalWinner = document.getElementById("modal-winner"); // Nome no modal
        const closeModalBtn = document.getElementById("closeModalBtn"); // Bot√£o para fechar o modal

        let sequentialNumber = 1; // N√∫mero sequencial para winners-list

        // Fun√ß√£o para buscar os dados do arquivo JSON no GitHub
        async function fetchData() {
            try {
                const response = await fetch(GITHUB_JSON_URL);
                if (!response.ok) {
                    throw new Error(`Erro ao buscar os dados: ${response.statusText}`);
                }
                data = await response.json(); // Parse do JSON
                remainingNames = [...new Set(data.map(obj => obj.nome))]; // Filtra nomes √∫nicos
                sortearBtn.disabled = false; // Habilita o bot√£o ap√≥s os dados serem carregados
                sortearBtn.textContent = "Sortear";
            } catch (error) {
                winnerDisplay.textContent = "Erro ao carregar os dados. Tente novamente mais tarde.";
                winnerDisplay.style.color = "red";
                console.error(error);
            }
        }

        // Fun√ß√£o para acionar confetes
        function launchConfetti() {
            const duration = 2 * 1000; // 2 segundos
            const end = Date.now() + duration;

            const colors = ["#bb0000", "#ffffff", "#ffdd00", "#00aaff", "#1f7a1f"];

            (function frame() {
                confetti({
                    particleCount: 3,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: colors
                });
                confetti({
                    particleCount: 3,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: colors
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            })();
        }

        // Fun√ß√£o para exibir ganhador na lista
        function updateWinnersList(winnerName) {
            const listItem = document.createElement('li');
            listItem.textContent = `${sequentialNumber}. ${winnerName}`; // Nome com n√∫mero sequencial
            winnersList.appendChild(listItem); // Adiciona na lista
            sequentialNumber++; // Incrementa o n√∫mero sequencial
        }

        // Fun√ß√£o para mostrar o modal
        function showModal(winnerName) {
            modalWinner.textContent = `üéâ Parab√©ns, ${winnerName}! üéâ`;
            modal.classList.add("active");
        }

        // Fun√ß√£o para fechar o modal
        function closeModal() {
            modal.classList.remove("active");
        }

        // Fun√ß√£o para sortear um nome
        function sortear() {
            // Verifica se h√° nomes restantes
            if (remainingNames.length === 0) {
                winnerDisplay.textContent = "Todos os nomes j√° foram sorteados!";
                winnerDisplay.style.color = "red";
                sortearBtn.classList.add("disabled"); // Desativa bot√£o
                sortearBtn.disabled = true;
                return;
            }

            // Sorteia um nome aleat√≥rio
            const randomIndex = Math.floor(Math.random() * remainingNames.length);
            const winnerName = remainingNames[randomIndex];

            // Remove o nome da lista
            remainingNames.splice(randomIndex, 1);

            // Exibe o vencedor
            updateWinnersList(winnerName);
            showModal(winnerName);
            launchConfetti();
        }

        // Adiciona evento ao bot√£o de sorteio
        sortearBtn.addEventListener("click", sortear);

        // Adiciona evento para fechar o modal
        closeModalBtn.addEventListener("click", closeModal);

        // Carrega os dados ao iniciar a p√°gina
        fetchData();
    </script>
</body>

</html>